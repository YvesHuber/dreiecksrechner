"use strict";
var isPlainObj = require("./isPlainObj");
var isArray = require("../array/isArray");

function mixin(source, target) {
    var copy = function (source, obj) {
        var src, target, copyIsArray, clone;
        for (var key in obj) {
            src = source[key];
            target = obj[key];

            if (src == target) continue;

            if (target && (isPlainObj(target) || (copyIsArray = isArray(target)))) {
                if (copyIsArray) {
                    copyIsArray = false;
                    clone = src && isArray(src) ? src : [];
                } else {
                    clone = src && isPlainObj(src) ? src : {};
                }

                source[key] = copy(clone, target);
            } else if (target !== undefined) {
                source[key] = target;
            }
        }
        return source;
    };

    var targets = [].slice.call(arguments, 1);

    targets.forEach(function (target) {
        source = copy(source, target);
    });

    return source;
}

module.exports = mixin;